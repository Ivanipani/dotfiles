export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="gnzh"

zstyle ':omz:update' mode reminder

HIST_STAMPS="mm/dd/yyyy"
plugins=(git zsh-autosuggestions zsh-syntax-highlighting zsh-vi-mode)

source $ZSH/oh-my-zsh.sh

setopt noautomenu
setopt nomenucomplete

# Functions
alias docker-stop-all='docker stop $(docker ps -aq) && docker rm $(docker ps -aq)'

function ns {
  emulate -L zsh -o pipefail
  setopt localoptions localtraps no_aliases

  # If the user hits Ctrl-C while the widget is running, restore the prompt.
  TRAPINT() { zle -I; zle reset-prompt; return 130 }

  zle -I  # flush ZLE state before launching an external program

  # Run on the real terminal, not via ZLEâ€™s stdio
  just --justfile ~/github/ivanipani/dotfiles/zellij/justfile sessionizer \
       </dev/tty >/dev/tty 2>&1
  local ret=$?

  zle reset-prompt   # redraw prompt after we return
  return $ret
}

zle -N ns

bindkey '^f' ns

function cs {
  emulate -L zsh -o pipefail
  setopt localoptions localtraps no_aliases

  # If the user hits Ctrl-C while the widget is running, restore the prompt.
  TRAPINT() { zle -I; zle reset-prompt; return 130 }

  zle -I  # flush ZLE state before launching an external program

  # Run on the real terminal, not via ZLE's stdio
  just --justfile ~/github/ivanipani/dotfiles/zellij/justfile sessionizer-zsh \
       </dev/tty >/dev/tty 2>&1
  local ret=$?

  zle reset-prompt   # redraw prompt after we return
  return $ret
}

zle -N cs

function f {
  # Prompt for directory using fd + fzf
  local selection
  selection=$(fd --type directory --base-directory "$HOME" \
                 | fzf --height=50% --padding=1% --border=double \
                       --header="CTRL-C or ESC to quit") || return

  # If user aborted fzf (Exit status != 0), bail out cleanly
  # (The '|| return' handles it.)

  # Compose the full path
  local target="$HOME/$selection"

  # Check if the directory still exists
  if [[ -d $target ]]; then
    cd -- "$target" || echo "Failed to cd into '$target'"
  else
    echo "Directory '$target' does not exist."
  fi
}

# Variables
export PATH="$HOME/.bun/bin:$HOME/.local/bin:$HOME/scripts:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:$HOME/.cargo/bin"
export PATH="/opt/homebrew/opt/postgresql@16/bin:$PATH"
export XDG_CONFIG_HOME="$HOME/.config"
export EDITOR="nvim"
export TERM="xterm-256color"

alias l="ls -lh"
alias la="ls -lha"
alias lt="ls -ltr"
alias lat="ls -latr"

alias v="nvim"
alias vim="nvim"
alias vimdiff="nvim -d"

. "$HOME/.cargo/env"
eval "$(direnv hook zsh)"
eval "$(just --completions zsh)"
eval "$(wezterm shell-completion --shell zsh)"
eval "$(atuin init zsh)"
eval "$(zellij setup --generate-completion zsh)"
eval "$(starship init zsh)"
# bun completions
[ -s "/Users/ivanperdomo/.bun/_bun" ] && source "/Users/ivanperdomo/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

# go
export PATH="$HOME/go/bin:/usr/local/go/bin:$PATH"
